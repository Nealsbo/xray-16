#include "common.h"
#include "iostructs\p_postpr.h"

uniform sampler2D 	s_base0;
uniform sampler2D 	s_base1;
uniform sampler2D 	s_distort;
uniform sampler2D 	s_grad0;
uniform sampler2D 	s_grad1;
uniform half4 		c_colormap;

//////////////////////////////////////////////////////////////////////////////////////////
// Pixel
half4 	_main	( p_postpr I )
{
	half4	pre_pass= tex2D		(s_base0, I.Tex0);
	half	grad_i 	= dot		(pre_pass.rgb,float3(0.3333));

	half3 	image0 	= tex2D		(s_grad0, half2(grad_i,0.5)).rgb;
	half3 	image1 	= tex2D		(s_grad1, half2(grad_i,0.5)).rgb;
	half3	image	= lerp		(image0, image1, c_colormap.y);
			image	= lerp		(pre_pass.rgb, image, c_colormap.x);

	return  half4	(image,1);					// +mov
}
